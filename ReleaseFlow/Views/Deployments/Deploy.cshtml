@{
    ViewData["Title"] = "New Deployment";
}

<!-- Hero Section -->
<div class="page-hero mb-4">
    <div class="position-relative">
        <h2 class="mb-2">
            <i class="bi bi-cloud-upload me-2"></i>
            New Deployment
        </h2>
        <p class="mb-0 opacity-90">
            Deploy a new version of your application
        </p>
    </div>
</div>

<!-- Deployment Form -->
<div class="row">
    <div class="col-md-8 offset-md-2">
        <div class="card modern-card" style="background: white;">
            <div class="card-header bg-light border-bottom">
                <h5 class="mb-0 fw-bold">
                    <i class="bi bi-magic me-2"></i>Deployment Wizard
                </h5>
            </div>
            <div class="card-body p-4">
                <form asp-action="Deploy" method="post" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label for="applicationId" class="form-label-modern">
                            <i class="bi bi-app me-2 text-primary"></i>Application *
                        </label>
                        <select name="applicationId" id="applicationId" class="form-control form-control-modern" required>
                            <option value="">-- Select Application --</option>
                            @foreach (var app in ViewBag.Applications as List<ReleaseFlow.Models.Application>)
                            {
                                <option value="@app.Id" selected="@(ViewBag.SelectedApplicationId == app.Id)">@app.Name (@app.Environment)</option>
                            }
                        </select>
                        <div class="form-text">Select the application to deploy</div>
                    </div>

                    <div class="mb-4">
                        <label for="version" class="form-label-modern">
                            <i class="bi bi-tag me-2 text-primary"></i>Version *
                        </label>
                        <input type="text" name="version" id="version" class="form-control form-control-modern" 
                               value="@ViewBag.SuggestedVersion" required />
                        <div class="form-text">
                            Auto-generated version based on date (YYYY.MM.DD.N). You can modify if needed.
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="zipFile" class="form-label-modern">
                            <i class="bi bi-file-earmark-zip me-2 text-primary"></i>ZIP Package *
                        </label>
                        <input type="file" name="zipFile" id="zipFile" class="form-control form-control-modern" 
                               accept=".zip" required />
                        <div class="form-text">Upload a ZIP file containing your application files (max 500MB)</div>
                    </div>

                    @if (ViewBag.ErrorDetails != null)
                    {
                        <div class="alert alert-danger">
                            <h6><i class="bi bi-exclamation-triangle me-2"></i>Deployment Error Details:</h6>
                            <pre class="mb-0">@ViewBag.ErrorDetails</pre>
                        </div>
                    }

                    <div class="mb-4">
                        <label for="releaseNotes" class="form-label-modern">
                            <i class="bi bi-journal-text me-2 text-primary"></i>Release Notes
                        </label>
                        <textarea name="releaseNotes" id="releaseNotes" class="form-control form-control-modern" rows="4" 
                                  placeholder="What's new in this version?"></textarea>
                        <div class="form-text">Optional notes about this deployment</div>
                    </div>

                    <div class="d-flex gap-2 justify-content-end">
                        <a asp-action="Index" class="btn btn-outline-secondary" style="border-radius: 8px; padding: 0.6rem 1.5rem; font-weight: 600;">
                            <i class="bi bi-x-circle me-1"></i>Cancel
                        </a>
                        <button type="submit" class="btn btn-primary" style="background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 8px; padding: 0.6rem 1.5rem; font-weight: 600;">
                            <i class="bi bi-rocket-takeoff me-1"></i>Start Deployment
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const appSelect = document.getElementById('applicationId');
        
        if (appSelect) {
            appSelect.addEventListener('change', function() {
                const appId = this.value;
                if (appId) {
                    // Reload page with selected application to get new suggested version
                    window.location.href = '/Deployments/Deploy?applicationId=' + appId;
                }
            });
        }
    });
</script>
